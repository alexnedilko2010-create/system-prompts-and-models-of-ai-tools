# Проверка комиссий Jupiter Perpetuals

## Проблема

Противоречивая информация о структуре комиссий:

### Вариант 1: Только фиксированная
- Базовая комиссия: **0.06%** от notional
- БЕЗ дополнительных fees

### Вариант 2: С динамическим impact fee
- Базовая: **0.06%**
- Price impact fee: динамическая, растет с размером

## Критичность для схемы

Для позиции $25M:

| Вариант | Open Fee | Close Fee | Total |
|---------|----------|-----------|-------|
| Фикс 0.06% | $15,000 | $15,000 | $30,000 |
| С impact (большим) | $640,000 | $640,000 | $1,280,000 |

**Разница: $1,250,000!**

Если Вариант 1 → Схема **РАБОТАЕТ** (прибыль ~$9k) ✅
Если Вариант 2 → Схема **НЕ РАБОТАЕТ** (убыток > $1M) ❌

## Способы проверки

### 1. Через UI (самый простой)
1. Открыть https://app.jup.ag/perps
2. Выбрать SOL-PERP
3. Попробовать создать позицию разных размеров
4. Посмотреть "Estimated Fee" перед открытием
5. Проверить для: $100k, $1M, $10M, $25M

### 2. Через SDK
```typescript
import { Jupiter } from '@jup-ag/api';
// Запросить quote для позиции
// Посмотреть fees в ответе
```

### 3. Анализ реальных транзакций
1. Найти на solscan.io крупные трейды Jupiter Perps
2. Посмотреть:
   - Position size
   - Fee paid
   - Вычислить процент

### 4. Изучить код контракта
- Найти GitHub репозиторий Jupiter Perps
- Посмотреть функцию расчета комиссий
- Проверить есть ли impact_fee_scalar

## Запуск скрипта проверки

```bash
# Установить зависимости
npm install @solana/web3.js @coral-xyz/anchor

# Запустить
npx ts-node check_jupiter_fees.ts
```

## Что покажет скрипт

Таблицу сравнения комиссий для разных сценариев:

```
Position | Fixed 0.06% | With Impact | Difference
---------|-------------|-------------|------------
$100k    | $60         | $70         | $10
$1M      | $600        | $1,600      | $1,000
$10M     | $6,000      | $106,000    | $100,000
$25M     | $15,000     | $640,000    | $625,000
```

## Рекомендация

**СНАЧАЛА проверить комиссии на практике!**

Самый быстрый способ:
1. Зайти на app.jup.ag/perps
2. Попробовать создать $1M позицию (не исполнять!)
3. Посмотреть estimated fee
4. Если ~$600 → Вариант 1 ✅
5. Если ~$1,600+ → Вариант 2 ❌

---

**Только после подтверждения структуры комиссий имеет смысл писать полный код для схемы!**
